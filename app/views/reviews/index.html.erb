<h1>レビューページ</h1>

<br>

<p>このアプリから映画の予約をお取りしたユーザーは、視聴した映画1つにつき1つレビューを投稿できます。(視聴した日の翌日以降)</p>

<table class="table">
  <thead>
    <tr>
      <th scope="col" style="width: 20%">投稿日時</th>
      <th scope="col" style="width: 10%">評価</th>
      <th scope="col" style="width: 50%">コメント</th>
      <% if current_user.admin %>
        <th scope="col" style="width: 20%">操作</th>
      <% end %>
    </tr>
  </thead>
  <tbody>
    <% @reviews.each do |review| %>
      <tr>
        <td><%= review.created_at.strftime('%m-%d %I:%M') %></td>
        <td>
          <% review.evaluation.times do %>
            <%= image_tag("star-on.png") %>
          <% end %>
        </td>
        <td><%= review.comment %></td>
        <% if current_user.admin %>
          <td>
            <%= link_to '削除', movie_review_path(@movie, review), method: :delete, data: { confirm: '本当に削除しますか？' } %>
          </td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>


<%# アラートの表示 %>
<div class="alert">
  <% if flash[:alert] %>
    <div class="alert alert-primary d-flex align-items-center" role="alert">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-exclamation-triangle-fill flex-shrink-0 me-2" viewBox="0 0 16 16">
        <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
      </svg>
      <div>
        <%= flash[:alert] %>
      </div>
    </div>
  <% end %>
  <% if @review.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@review.errors.count, "error") %> prohibited this review from being saved:</h2>
      <ul>
      <% @review.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>
</div>


<% if @can_review %>
  <%= form_with model: [ @movie, @review ], local: true, class: 'row gx-3 gy-2 align-items-center' do |f| %>
    <div class="col-sm-2">
      <label class="visually-hidden" for="specificSizeSelect">Preference</label>
      <%= f.select :evaluation, options_for_select([['星1 ~ 星5の評価を選択', nil], ['★☆☆☆☆', 1], ['★★☆☆☆', 2], ['★★★☆☆', 3], ['★★★★☆', 4], ['★★★★★', 5]]), {}, { class: 'form-select', id: 'specificSizeSelect' } %>
    </div>
    <div class="col-sm-7">
      <label class="visually-hidden" for="specificSizeInputName">Name</label>
      <%= f.text_field :comment, class: 'form-control', id: 'specificSizeInputName', placeholder: 'コメントを記述' %>
    </div>
    <div class="col-auto">
      <%= f.submit "送信", class: "btn btn-primary" %>
    </div>
  <% end %>
<% end %>

<br>
<%= link_to '戻る', movie_path(@movie) %>