# テーブル設計

## Movies
| Field Name | Data Type | Limit | Null | Comment |
| --- | --- | --- | --- | --- |
| name | string | 160 | false | 映画のタイトル。邦題・洋題は一旦考えなくてOK |
| year | string | 45 | | 公開年 |
| description | text | | | 映画の説明文 |
| image_url | string | 150 | | 映画のポスター画像が格納されているURL |
| is_showing | boolean | | false | 上映中かどうか |
| created_at | datetime | 6 | false | |
| updated_at | datetime | 6 | false | |


<br>

## Reservations

| Field Name | Data Type | Limit | Null | Comment |
| --- | --- | --- | --- | --- |
| date | date | | false | |
| schedule_id | bigint | | false | |
| screen_sheet_id | bigint | | false | |
| email | string | | false | 予約者メールアドレス |
| name | string | 50 | false | 予約者名 |
| created_at | datetime | 6 | false | |
| updated_at | datetime | 6 | false | |

<br>

## Schedules

| Field Name | Data Type | Limit | Null | Comment |
| --- | --- | --- | --- | --- |
| movie_id | bigint | | false | |
| start_time | time | | | |
| end_time | time | | | |
| created_at | datetime | 6 | false | |
| updated_at | datetime | 6 | false | |

<br>

## ScreenSheets

| Field Name | Data Type | Limit | Null | Comment |
| --- | --- | --- | --- | --- |
| screen_id | bigint | | | |
| sheet_id | bigint | | | |
| created_at | datetime | 6 | false | |
| updated_at | datetime | 6 | false | |


<br>

## Screens

| Field Name | Data Type | Limit | Null | Comment |
| --- | --- | --- | --- | --- |
| created_at | datetime | 6 | false | |
| updated_at | datetime | 6 | false | |


<br>

## Sheets

| Field Name | Data Type | Limit | Null | Comment |
| --- | --- | --- | --- | --- |
| column | integer | 1 | | |
| row | string | 1 | | |
| created_at | datetime | 6 | false | |
| updated_at | datetime | 6 | false | |

<br>

## Users

| Field Name | Data Type | Limit | Null | Comment |
| --- | --- | --- | --- | --- |
| name | string | | false | |
| email | string | | false | |
| encrypted_password | string | | false | |
| reset_password_token | string | | | |
| reset_password_sent_at | datetime | | | |
| remember_created_at | datetime | | | |
| created_at | datetime | 6 | false | |
| updated_at | datetime | 6 | false | |










# 座席予約システムのフロー

## 1.
座席選択画面に進んだ時点で
前の画面んで選択された@scheduleと@dateに該当する予約済み座席情報を
@booked_reservations_sheet_idsとして、reservationsテーブルから全て取り出す。

- - -

## 2.
ユーザーが予約できる座席情報を配列@candidate_screen_sheetsとして定義する
この配列には[a-1 ~ a-5, b-1 ~ b-5, c-1~c-5]まで計15個の座席情報がこれから入るものと仮定する

- - - 

## 3-1.(ループ処理)
@candidate_screen_sheetsとは別であらかじめ全ての座席情報が格納された@sheetsに対して
each do |sheet| で[a-1 ~ a-5, b-1 ~ b-5, c-1~c-5]の座席インスタンス1つ1つに対して処理を開始する。
このループ処理の中であらかじめ全てのスクリーン*座席情報が格納されたscreen_sheetsテーブルの中から
.where(sheet)でループ中のsheetインスタンスに該当するscreen_sheetsを全て取り出す(スクリーン1~スクリーン3まで取り出される)

## 3-2.(二重ループ処理)
取り出されたscreen_sheetsに対してeach do |screen_sheet|でスクリーン*座席情報インスタンス1つ1つに対して処理を開始する。
screen_sheetがスクリーン1,2,3全て格納済みであれば、@candidate_screen_sheetsに文字列"予約済み"をpushする
上記に該当しなければ
screen_sheetがスクリーン1,2,3のうち予約済みでなかったものを@candidate_screen_sheetsにscreen_sheetインスタンスをpushする

- - - 

## 4.
上記の処理を経て@candidate_screen_sheetsにはscreen_sheetインスタンスか文字列"予約済み"が格納される。

- - -

## 5.
ビューファイルでは[a-1 ~ a-5, b-1 ~ b-5, c-1~c-5]の全ての座席情報を表示するため、@sheetsインスタンスを全て表示する
このビューファイルに対して@candidate_screen_sheetsに@sheetsインスタンスから(:id)で参照する
@candidate_screen_sheetsの座席が"予約済み"あればリンク表示をさせない
@candidate_screen_sheetsの座席が"予約済み"でなければリンク表示をさせ、リンクがクリックされた際に予約情報に
配列の中の要素(screen_sheet)のidを格納する
